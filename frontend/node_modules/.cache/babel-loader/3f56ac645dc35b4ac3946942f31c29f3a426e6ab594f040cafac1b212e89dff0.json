{"ast":null,"code":"// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\nconst logInspector = require('../bidi/logInspector');\nconst scriptManager = require('../bidi//scriptManager');\nconst {\n  LocalValue,\n  ChannelValue\n} = require('../bidi/protocolValue');\nconst fs = require('node:fs');\nconst path = require('node:path');\nconst by = require('./by');\nclass Script {\n  #driver;\n  #logInspector;\n  #script;\n  constructor(driver) {\n    this.#driver = driver;\n  }\n\n  // This should be done in the constructor.\n  // But since it needs to call async methods we cannot do that in the constructor.\n  // We can have a separate async method that initialises the Script instance.\n  // However, that pattern does not allow chaining the methods as we would like the user to use it.\n  // Since it involves awaiting to get the instance and then another await to call the method.\n  // Using this allows the user to do this \"await driver.script().addJavaScriptErrorHandler(callback)\"\n  async #init() {\n    if (this.#logInspector !== undefined) {\n      return;\n    }\n    this.#logInspector = await logInspector(this.#driver);\n  }\n  async #initScript() {\n    if (this.#script !== undefined) {\n      return;\n    }\n    this.#script = await scriptManager([], this.#driver);\n  }\n  async addJavaScriptErrorHandler(callback) {\n    await this.#init();\n    return await this.#logInspector.onJavascriptException(callback);\n  }\n  async removeJavaScriptErrorHandler(id) {\n    await this.#init();\n    await this.#logInspector.removeCallback(id);\n  }\n  async addConsoleMessageHandler(callback) {\n    await this.#init();\n    return this.#logInspector.onConsoleEntry(callback);\n  }\n  async removeConsoleMessageHandler(id) {\n    await this.#init();\n    await this.#logInspector.removeCallback(id);\n  }\n  async addDomMutationHandler(callback) {\n    await this.#initScript();\n    let argumentValues = [];\n    let value = LocalValue.createChannelValue(new ChannelValue('channel_name'));\n    argumentValues.push(value);\n    const filePath = path.join(__dirname, 'atoms', 'bidi-mutation-listener.js');\n    let mutationListener = fs.readFileSync(filePath, 'utf-8').toString();\n    await this.#script.addPreloadScript(mutationListener, argumentValues);\n    let id = await this.#script.onMessage(async message => {\n      let payload = JSON.parse(message['data']['value']);\n      let elements = await this.#driver.findElements({\n        css: '*[data-__webdriver_id=' + by.escapeCss(payload['target']) + ']'\n      });\n      if (elements.length === 0) {\n        return;\n      }\n      let event = {\n        element: elements[0],\n        attribute_name: payload['name'],\n        current_value: payload['value'],\n        old_value: payload['oldValue']\n      };\n      callback(event);\n    });\n    return id;\n  }\n  async removeDomMutationHandler(id) {\n    await this.#initScript();\n    await this.#script.removeCallback(id);\n  }\n  async pin(script) {\n    await this.#initScript();\n    return await this.#script.addPreloadScript(script);\n  }\n  async unpin(id) {\n    await this.#initScript();\n    await this.#script.removePreloadScript(id);\n  }\n  async execute(script, ...args) {\n    await this.#initScript();\n    const browsingContextId = await this.#driver.getWindowHandle();\n    const argumentList = [];\n    args.forEach(arg => {\n      argumentList.push(LocalValue.getArgument(arg));\n    });\n    const response = await this.#script.callFunctionInBrowsingContext(browsingContextId, script, true, argumentList);\n    return response.result;\n  }\n}\nmodule.exports = Script;","map":{"version":3,"names":["logInspector","require","scriptManager","LocalValue","ChannelValue","fs","path","by","Script","driver","script","constructor","init","#init","undefined","initScript","#initScript","addJavaScriptErrorHandler","callback","onJavascriptException","removeJavaScriptErrorHandler","id","removeCallback","addConsoleMessageHandler","onConsoleEntry","removeConsoleMessageHandler","addDomMutationHandler","argumentValues","value","createChannelValue","push","filePath","join","__dirname","mutationListener","readFileSync","toString","addPreloadScript","onMessage","message","payload","JSON","parse","elements","findElements","css","escapeCss","length","event","element","attribute_name","current_value","old_value","removeDomMutationHandler","pin","unpin","removePreloadScript","execute","args","browsingContextId","getWindowHandle","argumentList","forEach","arg","getArgument","response","callFunctionInBrowsingContext","result","module","exports"],"sources":["C:/Users/rayan/Documents/GitHub/Project-Outils/node_modules/selenium-webdriver/lib/script.js"],"sourcesContent":["// Licensed to the Software Freedom Conservancy (SFC) under one\n// or more contributor license agreements.  See the NOTICE file\n// distributed with this work for additional information\n// regarding copyright ownership.  The SFC licenses this file\n// to you under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance\n// with the License.  You may obtain a copy of the License at\n//\n//   http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing,\n// software distributed under the License is distributed on an\n// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.  See the License for the\n// specific language governing permissions and limitations\n// under the License.\n\nconst logInspector = require('../bidi/logInspector')\nconst scriptManager = require('../bidi//scriptManager')\nconst { LocalValue, ChannelValue } = require('../bidi/protocolValue')\nconst fs = require('node:fs')\nconst path = require('node:path')\nconst by = require('./by')\n\nclass Script {\n  #driver\n  #logInspector\n  #script\n\n  constructor(driver) {\n    this.#driver = driver\n  }\n\n  // This should be done in the constructor.\n  // But since it needs to call async methods we cannot do that in the constructor.\n  // We can have a separate async method that initialises the Script instance.\n  // However, that pattern does not allow chaining the methods as we would like the user to use it.\n  // Since it involves awaiting to get the instance and then another await to call the method.\n  // Using this allows the user to do this \"await driver.script().addJavaScriptErrorHandler(callback)\"\n  async #init() {\n    if (this.#logInspector !== undefined) {\n      return\n    }\n    this.#logInspector = await logInspector(this.#driver)\n  }\n\n  async #initScript() {\n    if (this.#script !== undefined) {\n      return\n    }\n    this.#script = await scriptManager([], this.#driver)\n  }\n\n  async addJavaScriptErrorHandler(callback) {\n    await this.#init()\n    return await this.#logInspector.onJavascriptException(callback)\n  }\n\n  async removeJavaScriptErrorHandler(id) {\n    await this.#init()\n    await this.#logInspector.removeCallback(id)\n  }\n\n  async addConsoleMessageHandler(callback) {\n    await this.#init()\n    return this.#logInspector.onConsoleEntry(callback)\n  }\n\n  async removeConsoleMessageHandler(id) {\n    await this.#init()\n\n    await this.#logInspector.removeCallback(id)\n  }\n\n  async addDomMutationHandler(callback) {\n    await this.#initScript()\n\n    let argumentValues = []\n    let value = LocalValue.createChannelValue(new ChannelValue('channel_name'))\n    argumentValues.push(value)\n\n    const filePath = path.join(__dirname, 'atoms', 'bidi-mutation-listener.js')\n\n    let mutationListener = fs.readFileSync(filePath, 'utf-8').toString()\n    await this.#script.addPreloadScript(mutationListener, argumentValues)\n\n    let id = await this.#script.onMessage(async (message) => {\n      let payload = JSON.parse(message['data']['value'])\n      let elements = await this.#driver.findElements({\n        css: '*[data-__webdriver_id=' + by.escapeCss(payload['target']) + ']',\n      })\n\n      if (elements.length === 0) {\n        return\n      }\n\n      let event = {\n        element: elements[0],\n        attribute_name: payload['name'],\n        current_value: payload['value'],\n        old_value: payload['oldValue'],\n      }\n      callback(event)\n    })\n\n    return id\n  }\n\n  async removeDomMutationHandler(id) {\n    await this.#initScript()\n\n    await this.#script.removeCallback(id)\n  }\n\n  async pin(script) {\n    await this.#initScript()\n    return await this.#script.addPreloadScript(script)\n  }\n\n  async unpin(id) {\n    await this.#initScript()\n    await this.#script.removePreloadScript(id)\n  }\n\n  async execute(script, ...args) {\n    await this.#initScript()\n\n    const browsingContextId = await this.#driver.getWindowHandle()\n\n    const argumentList = []\n\n    args.forEach((arg) => {\n      argumentList.push(LocalValue.getArgument(arg))\n    })\n\n    const response = await this.#script.callFunctionInBrowsingContext(browsingContextId, script, true, argumentList)\n\n    return response.result\n  }\n}\n\nmodule.exports = Script\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}